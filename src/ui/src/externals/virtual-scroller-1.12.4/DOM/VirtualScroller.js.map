{"version":3,"file":"VirtualScroller.js","names":["VirtualScrollerCore","log","warn","px","VirtualScroller","itemsContainerElement","items","renderItem","options","state","prevState","firstShownItemIndex","lastShownItemIndex","beforeItemsHeight","afterItemsHeight","tbody","container","style","paddingTop","paddingBottom","diffRender","length","i","unmountItem","childNodes","firstChild","shouldPrependItems","prependBeforeItemElement","item","insertBefore","appendChild","stop","virtualScroller","start","onMount","onItemUnmount","restOptions","tagName","render","itemElement","removeChild","onItemHeightDidChange","newState","setItemState","newItems","setItems"],"sources":["../../source/DOM/VirtualScroller.js"],"sourcesContent":["import VirtualScrollerCore from '../VirtualScroller.js'\n\nimport log, { warn } from '../utility/debug.js'\nimport px from '../utility/px.js'\n\nexport default class VirtualScroller {\n  constructor(itemsContainerElement, items, renderItem, options = {}) {\n    this.container = itemsContainerElement\n    this.renderItem = renderItem\n\n    const {\n      onMount,\n      onItemUnmount,\n      ...restOptions\n    } = options\n\n    this.onItemUnmount = onItemUnmount\n    this.tbody = this.container.tagName === 'TBODY'\n\n    this.virtualScroller = new VirtualScrollerCore(\n      () => this.container,\n      items,\n      {\n        ...restOptions,\n        render: this.render,\n        tbody: this.tbody\n      }\n    )\n\n    this.start()\n\n    // `onMount()` option is deprecated due to no longer being used.\n    // If someone thinks there's a valid use case for it, create an issue.\n    if (onMount) {\n      onMount()\n    }\n  }\n\n  render = (state, prevState) => {\n    const {\n      items,\n      firstShownItemIndex,\n      lastShownItemIndex,\n      beforeItemsHeight,\n      afterItemsHeight\n    } = state\n\n    // log('~ On state change ~')\n    // log('Previous state', prevState)\n    // log('New state', state)\n\n    // Set container padding top and bottom.\n    // Work around `<tbody/>` not being able to have `padding`.\n    // https://gitlab.com/catamphetamine/virtual-scroller/-/issues/1\n    // `this.virtualScroller` hasn't been initialized yet at this stage,\n    // so using `this.tbody` instead of `this.virtualScroller.tbody`.\n    if (!this.tbody) {\n      this.container.style.paddingTop = px(beforeItemsHeight)\n      this.container.style.paddingBottom = px(afterItemsHeight)\n    }\n\n    // Perform an intelligent \"diff\" re-render if the `items` are the same.\n    const diffRender = prevState && items === prevState.items && items.length > 0\n    // Remove no longer visible items from the DOM.\n    if (diffRender) {\n      // Decrement instead of increment here because\n      // `this.container.removeChild()` changes indexes.\n      let i = prevState.lastShownItemIndex\n      while (i >= prevState.firstShownItemIndex) {\n        if (i >= firstShownItemIndex && i <= lastShownItemIndex) {\n          // The item is still visible.\n        } else {\n          log('DOM: Remove element for item index', i)\n          // The item is no longer visible. Remove it.\n          this.unmountItem(this.container.childNodes[i - prevState.firstShownItemIndex])\n        }\n        i--\n      }\n    } else {\n      log('DOM: Rerender the list from scratch')\n      while (this.container.firstChild) {\n        this.unmountItem(this.container.firstChild)\n      }\n    }\n\n    // Add newly visible items to the DOM.\n    let shouldPrependItems = diffRender\n    const prependBeforeItemElement = shouldPrependItems && this.container.firstChild\n    let i = firstShownItemIndex\n    while (i <= lastShownItemIndex) {\n      if (diffRender && i >= prevState.firstShownItemIndex && i <= prevState.lastShownItemIndex) {\n        // The item is already being rendered.\n        // Next items will be appended rather than prepended.\n        if (shouldPrependItems) {\n          shouldPrependItems = false\n        }\n      } else {\n        const item = this.renderItem(items[i])\n        if (shouldPrependItems) {\n          log('DOM: Prepend element for item index', i)\n          // Append `item` to `this.container` before the retained items.\n          this.container.insertBefore(item, prependBeforeItemElement)\n        } else {\n          log('DOM: Append element for item index', i)\n          // Append `item` to `this.container`.\n          this.container.appendChild(item)\n        }\n      }\n      i++\n    }\n  }\n\n  // Public API. Should be \"bound\" to `this`.\n  onUnmount = () => {\n    warn('`.onUnmount()` instance method name is deprecated, use `.stop()` instance method name instead.')\n    this.stop()\n  }\n\n  // Public API. Should be \"bound\" to `this`.\n  destroy = () => {\n    warn('`.destroy()` instance method name is deprecated, use `.stop()` instance method name instead.')\n    this.stop()\n  }\n\n  // Public API.\n  // Should be \"bound\" to `this`.\n  stop = () => {\n    this.virtualScroller.stop()\n  }\n\n  // Potentially public API in some hypothetical scenario.\n  // Should be \"bound\" to `this`.\n  start = () => {\n    this.virtualScroller.start()\n  }\n\n  unmountItem(itemElement) {\n    this.container.removeChild(itemElement)\n    if (this.onItemUnmount) {\n      this.onItemUnmount(itemElement)\n    }\n  }\n\n  /**\n   * @deprecated\n   * `.onItemHeightChange()` has been renamed to `.onItemHeightDidChange()`.\n   */\n  onItemHeightChange(i) {\n    warn('`.onItemHeightChange(i)` method was renamed to `.onItemHeightDidChange(i)`')\n    this.onItemHeightDidChange(i)\n  }\n\n  onItemHeightDidChange(i) {\n    this.virtualScroller.onItemHeightDidChange(i)\n  }\n\n  setItemState(i, newState) {\n    this.virtualScroller.setItemState(i, newState)\n  }\n\n  /**\n   * @deprecated\n   * `.updateItems()` has been renamed to `.setItems()`.\n   */\n  updateItems(newItems, options) {\n    warn('`.updateItems()` method was renamed to `.setItems(i)`')\n    this.setItems(newItems, options)\n  }\n\n  setItems(newItems, options) {\n    this.virtualScroller.setItems(newItems, options)\n  }\n\n  /*\n  getItemCoordinates(i) {\n    return this.virtualScroller.getItemCoordinates(i)\n  }\n  */\n}"],"mappings":"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"}