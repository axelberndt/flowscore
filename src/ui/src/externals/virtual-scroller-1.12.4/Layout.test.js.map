{"version":3,"file":"Layout.test.js","names":["Layout","Engine","describe","it","SCREEN_HEIGHT","scrollableContainer","width","height","ITEM_WIDTH","ITEM_HEIGHT","VERTICAL_SPACING","items","Array","fill","layout","getPrerenderMargin","getVerticalSpacing","getColumnsCount","getItemHeight","i","getBeforeResizeItemsCount","getAverageItemHeight","getScrollableContainerHeight","getShownItemIndexes","itemsCount","length","visibleAreaInsideTheList","top","bottom","should","deep","equal","firstShownItemIndex","lastShownItemIndex","getLayoutUpdateForItemsDiff","beforeItemsHeight","afterItemsHeight","prependedItemsCount","appendedItemsCount","columnsCount","shouldResetGridLayout","errors","global","VirtualScrollerCatchError","error","push","shouldRestoreScrollPosition","onResetGridLayout","undefined","message"],"sources":["../source/Layout.test.js"],"sourcesContent":["import Layout from './Layout.js'\n\nimport Engine from './test/Engine.js'\n\ndescribe('Layout', function() {\n\tit('should work', function() {\n\t\tconst SCREEN_HEIGHT = 400\n\n\t\tconst scrollableContainer = {\n\t\t\twidth: 800,\n\t\t\theight: SCREEN_HEIGHT\n\t\t}\n\n\t\tconst ITEM_WIDTH = scrollableContainer.width\n\t\tconst ITEM_HEIGHT = 200\n\n\t\tconst VERTICAL_SPACING = 100\n\n\t\tconst items = new Array(9).fill(ITEM_WIDTH * ITEM_HEIGHT)\n\n\t\tconst layout = new Layout({\n\t\t\tgetPrerenderMargin: () => SCREEN_HEIGHT,\n\t\t\tgetVerticalSpacing: () => VERTICAL_SPACING,\n\t\t\tgetColumnsCount: () => 1,\n\t\t\tgetItemHeight: (i) => items[i] / scrollableContainer.width,\n\t\t\tgetBeforeResizeItemsCount: () => 0,\n\t\t\tgetAverageItemHeight: () => ITEM_HEIGHT,\n\t\t\tgetScrollableContainerHeight: () => scrollableContainer.height\n\t\t})\n\n\t\t// Initial render.\n\t\tlayout.getShownItemIndexes({\n\t\t\titemsCount: items.length,\n\t\t\tvisibleAreaInsideTheList: {\n\t\t\t\ttop: 0,\n\t\t\t\tbottom: SCREEN_HEIGHT\n\t\t\t}\n\t\t}).should.deep.equal({\n\t\t\tfirstShownItemIndex: 0,\n\t\t\tlastShownItemIndex: 2\n\t\t})\n\n\t\t// The first item is almost hidden.\n\t\tlayout.getShownItemIndexes({\n\t\t\titemsCount: items.length,\n\t\t\tvisibleAreaInsideTheList: {\n\t\t\t\ttop: SCREEN_HEIGHT + ITEM_HEIGHT - 1,\n\t\t\t\tbottom: (SCREEN_HEIGHT + ITEM_HEIGHT - 1) + SCREEN_HEIGHT\n\t\t\t}\n\t\t}).should.deep.equal({\n\t\t\tfirstShownItemIndex: 0,\n\t\t\tlastShownItemIndex: 4\n\t\t})\n\n\t\t// The first item is hidden.\n\t\tlayout.getShownItemIndexes({\n\t\t\titemsCount: items.length,\n\t\t\tvisibleAreaInsideTheList: {\n\t\t\t\ttop: SCREEN_HEIGHT + ITEM_HEIGHT,\n\t\t\t\tbottom: (SCREEN_HEIGHT + ITEM_HEIGHT) + SCREEN_HEIGHT\n\t\t\t}\n\t\t}).should.deep.equal({\n\t\t\tfirstShownItemIndex: 1,\n\t\t\tlastShownItemIndex: 4\n\t\t})\n\n\t\t// A new item at the bottom is almost visible.\n\t\tlayout.getShownItemIndexes({\n\t\t\titemsCount: items.length,\n\t\t\tvisibleAreaInsideTheList: {\n\t\t\t\ttop: (ITEM_HEIGHT + VERTICAL_SPACING) * 5 - SCREEN_HEIGHT * 2,\n\t\t\t\tbottom: (ITEM_HEIGHT + VERTICAL_SPACING) * 5 - SCREEN_HEIGHT\n\t\t\t}\n\t\t}).should.deep.equal({\n\t\t\tfirstShownItemIndex: 1,\n\t\t\tlastShownItemIndex: 4\n\t\t})\n\n\t\t// A new item at the bottom is visible.\n\t\tlayout.getShownItemIndexes({\n\t\t\titemsCount: items.length,\n\t\t\tvisibleAreaInsideTheList: {\n\t\t\t\ttop: (ITEM_HEIGHT + VERTICAL_SPACING) * 5 + 1 - SCREEN_HEIGHT * 2,\n\t\t\t\tbottom: (ITEM_HEIGHT + VERTICAL_SPACING) * 5 + 1 - SCREEN_HEIGHT\n\t\t\t}\n\t\t}).should.deep.equal({\n\t\t\tfirstShownItemIndex: 1,\n\t\t\tlastShownItemIndex: 5\n\t\t})\n\t})\n\n\tit('should update layout for items incremental change', function() {\n\t\tconst scrollableContainer = {\n\t\t\twidth: 800,\n\t\t\theight: 400\n\t\t}\n\n\t\tconst ITEM_WIDTH = scrollableContainer.width\n\t\tconst ITEM_HEIGHT = 200\n\n\t\tconst items = new Array(9).fill(ITEM_WIDTH * ITEM_HEIGHT)\n\n\t\tconst VERTICAL_SPACING = 100\n\n\t\tconst layout = new Layout({\n\t\t\tgetPrerenderMargin: () => scrollableContainer.height,\n\t\t\tgetVerticalSpacing: () => VERTICAL_SPACING,\n\t\t\tgetColumnsCount: () => 1,\n\t\t\tgetItemHeight: (i) => ITEM_HEIGHT,\n\t\t\tgetBeforeResizeItemsCount: () => 0,\n\t\t\tgetAverageItemHeight: () => ITEM_HEIGHT,\n\t\t\tgetScrollableContainerHeight: () => scrollableContainer.height\n\t\t})\n\n\t\tlayout.getLayoutUpdateForItemsDiff(\n\t\t\t{\n\t\t\t\tfirstShownItemIndex: 3,\n\t\t\t\tlastShownItemIndex: 5,\n\t\t\t\tbeforeItemsHeight: 3 * (ITEM_HEIGHT + VERTICAL_SPACING),\n\t\t\t\tafterItemsHeight: 3 * (ITEM_HEIGHT + VERTICAL_SPACING)\n\t\t\t},\n\t\t\t{\n\t\t\t\tprependedItemsCount: 5,\n\t\t\t\tappendedItemsCount: 5\n\t\t\t}, {\n\t\t\t\titemsCount: 5 + 5 + items.length,\n\t\t\t\tcolumnsCount: 1\n\t\t\t}\n\t\t).should.deep.equal({\n\t\t\tfirstShownItemIndex: 5 + 3,\n\t\t\tlastShownItemIndex: 5 + 5,\n\t\t\tbeforeItemsHeight: (5 + 3) * (ITEM_HEIGHT + VERTICAL_SPACING),\n\t\t\tafterItemsHeight: (3 + 5) * (ITEM_HEIGHT + VERTICAL_SPACING)\n\t\t})\n\t})\n\n\tit('should update layout for items incremental change (rows get rebalanced)', function() {\n\t\tconst scrollableContainer = {\n\t\t\twidth: 800,\n\t\t\theight: 400\n\t\t}\n\t\tconst ITEM_WIDTH = scrollableContainer.width\n\t\tconst ITEM_HEIGHT = 400\n\n\t\tconst items = new Array(9).fill(ITEM_WIDTH * ITEM_HEIGHT)\n\n\t\tconst VERTICAL_SPACING = 100\n\n\t\tconst layout = new Layout({\n\t\t\tgetPrerenderMargin: () => scrollableContainer.height,\n\t\t\tgetVerticalSpacing: () => VERTICAL_SPACING,\n\t\t\tgetColumnsCount: () => 4,\n\t\t\tgetItemHeight: () => ITEM_HEIGHT,\n\t\t\tgetBeforeResizeItemsCount: () => 0,\n\t\t\tgetAverageItemHeight: () => ITEM_HEIGHT,\n\t\t\tgetScrollableContainerHeight: () => scrollableContainer.height\n\t\t})\n\n\t\tlet shouldResetGridLayout\n\n\t\tconst errors = []\n\n\t\tglobal.VirtualScrollerCatchError = (error) => errors.push(error)\n\n\t\tlayout.getLayoutUpdateForItemsDiff(\n\t\t\t{\n\t\t\t\tfirstShownItemIndex: 3,\n\t\t\t\tlastShownItemIndex: 5,\n\t\t\t\tbeforeItemsHeight: 3 * (ITEM_HEIGHT + VERTICAL_SPACING),\n\t\t\t\tafterItemsHeight: 3 * (ITEM_HEIGHT + VERTICAL_SPACING)\n\t\t\t},\n\t\t\t{\n\t\t\t\tprependedItemsCount: 5,\n\t\t\t\tappendedItemsCount: 5\n\t\t\t}, {\n\t\t\t\titemsCount: 5 + 5 + items.length,\n\t\t\t\tcolumnsCount: 4,\n\t\t\t\tshouldRestoreScrollPosition: true,\n\t\t\t\tonResetGridLayout: () => shouldResetGridLayout = true\n\t\t\t}\n\t\t).should.deep.equal({\n\t\t\tfirstShownItemIndex: 0,\n\t\t\tlastShownItemIndex: 5 + 5,\n\t\t\tbeforeItemsHeight: 0,\n\t\t\tafterItemsHeight: 5 * (ITEM_HEIGHT + VERTICAL_SPACING)\n\t\t})\n\n\t\tglobal.VirtualScrollerCatchError = undefined\n\t\terrors.length.should.equal(2)\n\t\terrors[0].message.should.equal('[virtual-scroller] ~ Prepended items count 5 is not divisible by Columns Count 4 ~')\n\t\terrors[1].message.should.equal('[virtual-scroller] Layout reset required')\n\n\t\tshouldResetGridLayout.should.equal(true)\n\t})\n})"],"mappings":"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"}